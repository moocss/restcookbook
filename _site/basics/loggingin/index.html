<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta content='description' name='The RESTful Cookbook 是由 Joshua Thijssen 及其小伙伴编写的一本关于 RESTful 的手册。这个仓库是由 sofish 提供的中文译本。'>

        <link href='/css/blueprint/screen.css' type='text/css' rel='stylesheet' media='screen, projection'>
        <link href='/css/blueprint/print.css'  type='text/css' rel='stylesheet' media='print'>
        <link href='/css/restcookbook.css'   type='text/css' rel='stylesheet' media='screen, projection'>
        <!--[if lt IE 8]> >%link{:rel=>"stylesheet", :href=>"css/blueprint/ie.css", :type=>"text/css", :media=>"screen, projection"} <![endif]-->

        <title> How do I let users log into my RESTful API? |  - RESTful 手册</title>
    </head>

    <body>
        <div><a href="https://github.com/sofish/restcookbook"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a></div>

        <div id="logostrip">
            <div class="container">
                <div class="span-24 last" id="topheader">
                    <h1><a href='/'>RESTful 手册</a></h1>
                </div>
                <div class="span-2">
                    &nbsp;
                </div>
                <div class="span-22 last" id="topsubheader">
                    <h4><em> RESTful</em></h4>
                </div>
            </div>
        </div>

        <div class='last sidebar span-10'>
            <h2>话题列表</h2>
            <ul class="topics">

                
                    <li class="topic-header"><b>http methods</b> (5)</li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/http%20methods/options/">How do I know which HTTP methods are supported</a></li>
                        </ul>
                    </li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/http%20methods/put-vs-post/">When to use PUT or POST</a></li>
                        </ul>
                    </li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/http%20methods/patch/">When to use the PATCH method</a></li>
                        </ul>
                    </li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/http%20methods/idempotency/">What are idempotent and/or safe methods?</a></li>
                        </ul>
                    </li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/http%20methods/400-vs-500/">When to send 4xx or 5xx codes</a></li>
                        </ul>
                    </li>
                    
                
                    <li class="topic-header"><b>basics</b> (5)</li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/basics/loggingin/">How do I let users log into my RESTful API?</a></li>
                        </ul>
                    </li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/basics/caching/">Caching your REST API</a></li>
                        </ul>
                    </li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/basics/versioning/">How do I version my REST API?</a></li>
                        </ul>
                    </li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/basics/hateoas/">What is HATEOAS and why is it important?</a></li>
                        </ul>
                    </li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/basics/codeondemand/">What is the code-on-demand constraint?</a></li>
                        </ul>
                    </li>
                    
                
                    <li class="topic-header"><b>resources</b> (4)</li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/resources/using-custom-content-types/">Custom content-types</a></li>
                        </ul>
                    </li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/resources/pagination/">Paginating collections</a></li>
                        </ul>
                    </li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/resources/link-types/">Using link-types in relations</a></li>
                        </ul>
                    </li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/resources/asynchroneous-operations/">Asynchronous operations</a></li>
                        </ul>
                    </li>
                    
                
                    <li class="topic-header"><b>miscellaneous</b> (3)</li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/miscellaneous/richardsonmaturitymodel/">What is the Richardson Maturity Model?</a></li>
                        </ul>
                    </li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/miscellaneous/rest-and-http/">Are REST and HTTP the same thing?</a></li>
                        </ul>
                    </li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/miscellaneous/rest-presentations/">Where to find REST presentations</a></li>
                        </ul>
                    </li>
                    
                
                    <li class="topic-header"><b>http headers</b> (1)</li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/http%20headers/acceptlanguage/">Unsatisfied Accept-Language header</a></li>
                        </ul>
                    </li>
                    
                
                    <li class="topic-header"><b>mediatypes</b> (1)</li>
                    
                    <li>
                        <ul class='subnavlist'>
                            <li class='recipe'><a href="/mediatypes/json/">Is my API RESTful when I use JSON?</a></li>
                        </ul>
                    </li>
                    
                

            </ul>
        </div>


        <div class="container">
            <div class="span-16 last">
                &nbsp;
            </div>
            <div class="span-15">
                <div class="span-16 last" id="bodycontent">

                    <p class="question">I want users to login into my RESTful API so only they can see (protected) resources. What is the correct way to do this?</p>

<p>One of the main differences between RESTful and other server-client communications services is that any session state in a RESTful setup is held in the client, the server is stateless. This requires the client to provide all information necessary to make the request.</p>

<h3>Using HTTP basic authentication</h3>
<p>The most simple way to deal with authentication is to use HTTP basic authentication. We use a special HTTP header where
    we add 'username:password' encoded in base64.</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml">GET / HTTP/1.1
Host: example.org
Authorization: Basic Zm9vOmJhcg==</code></pre></div>

<p>
Note that even though your credentials are encoded, they are not encrypted! It is very easy to retrieve the username and
password from a basic authentication. Do not use this authentication scheme on plain HTTP, but only through SSL/TLS.</p>

<h3>HMAC</h3>
<p>One of the downsides of basic authentication is that we need to send over the password on every request. Also, it
    does not safeguard against tampering of headers or body. Another way is to use HMAC (hash based message authentication).
Instead of having passwords that needs to be send over, we actually send a hashed version of the password, together with more information.

Let's assume we have the following credentials: username "johndoe", password "secret". Suppose we try to access a protected resource <b>/users/foo/financialrecords</b>.

First, we need to fetch all the information we need, and concatenate this.

<div class="highlight"><pre><code class="language-xml" data-lang="xml">GET+/users/johndoe/financialrecords</code></pre></div>

<p>Here, we just concatenate the HTTP verb and the actual URL. We could add other information as well, like the current timestamp, a
    random number, or the md5 of the message body in order to prevent tampering of the body, or prevent replay attacks. Next, we generate
    a hmac:</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml">digest = base64encode(hmac(&quot;sha256&quot;, &quot;secret&quot;, &quot;GET+/users/foo/financialrecords&quot;))</code></pre></div>

<p>This digest we can send over as a HTTP header:</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml">GET /users/johndoe/financialrecords HTTP/1.1
Host: example.org
Authentication: hmac johndoe:[digest]</code></pre></div>

<p>
Right now, the server knows the user "johndoe" tries to acces the resource. The server can generate the digest as
well, since it has all information (note that the "password" is not encrypted on the server, as the server needs to know
the actual value. Hence we call this a "secret", not a "password".
</p>

<p>
Even if somebody was listening in on the conversation, it could not use the authentication information to POST data to
john's financial records, or look at some other users financial records, or any other URL, as this would change the digest and
the eavesdropper does not have the secret that both the server and client has.</p>
<p>
However, the eavesdropper could access John's financial records whenever it wants since it doesn't change the digest. This
    is why many times more information is send over, like the current time, and a nonce:
</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml">digest = base64encode(hmac(&quot;sha256&quot;, &quot;secret&quot;, &quot;GET+/users/foo/financialrecords+20apr201312:59:24+123456&quot;))</code></pre></div>

<p>We added two extra pieces of information. The current date and a number that we only use once (nonce)</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml">GET /users/johndoe/financialrecords HTTP/1.1
Host: example.org
Authentication: hmac johndoe:123456:[digest]
Date: 20 apr 2013 12:59:24</code></pre></div>

<p>
The server can reconstruct the digest again, since the client sends over the nonce and date. When the date is not in a
certain range of the current servers time (say, 10 minutes), the server can ignore the message, as it probably is a
replay of an earlier send message (note: either that, or the server or clients time is wrong. This is a common issue when
dealing with time-limited authencations!).
</p>

<p>
The nonce is a number we only use once. If we want to access the same resource again, we MUST change this number. This
means that every time we access a resource, the nonce will be different, and thus the digest will be different, even if we
access the resource in the same second. This way we are sure that no replay attacks can be done. Each request is only valid
once, and only once.</p>

<h3>OAuth</h3>
<p>One of the downsides of hmac is that there are no more passwords, but just plain secrets. When johns secret gets out,
    everyone could use that secret to access the account of john. A common way to prevent this is to use temporary
    tokens. John "asks" the server for a "token" and "secret", and with these token and secret, it is allowed to access its
    protected resources.</p>
<p>OAuth is a mechanism that allows you to create temporary tokens. It is a common used scheme for authentication and
    authorization, however the OAuth(1.1) specification is a bit difficult to implement for beginners. However, many
    libraries in pretty much every language exist to make this much easier to implement.</p>

<h3>OAuth2</h3>
<p>Even though the name suggests its the next version of OAuth, the whole structure has changed radically and cannot even
    be considered a new version. OAuth2 is a complete new way of authentication which is easier to implement and maintain.
    However, OAuth2 is not officially a standard yet, although many sites and organizations are using the current drafts.</p>

<h3>See also</h3>
<ul>
    <li><a href="http://tools.ietf.org/html/rfc7235#section-2">RFC 7235 - Access Authentication Framework</a>
    <li><a href="http://tools.ietf.org/html/rfc2617">RFC 2617 - HTTP Authentication: Basic and Digest Access Authentication</a>
    <li><a href="http://oauth.net/">OAuth specifications</a>
    <li><a href="http://tools.ietf.org/html/rfc6749">RFC 6749 - OAuth2 proposed standard</a>
</ul>

<h3>Caveats</h3>
<ul>
    <li>Basic authentication and OAuth versions MUST be protected through SSL/TLS. They should not be used over plain HTTP.</li>
    <li>Using nonces can improve your security, but you MUST store and compare nonces server-side.</li>
    <li>A common issue when using time-windows for request, is that either server or client is not using the correct time. Make
        sure both server and client are using systems like NTP to keep times in sync</li>
</ul>


<div style='margin: 3em'>
    <span class='st_facebook_hcount' title='Facebook'></span>
    <span class='st_twitter_hcount' title='Tweet'></span>
    <span class='st_linkedin_hcount' title='LinkedIn'></span>
    <span class='st_googleplus_hcount' title='Google +'></span>
    <span class='st_email_hcount' title='Email'></span>
    <br>
    <br>
    <hr>
    <div style='float:right'>
        <address>This recipe has been written by
        
            <a href="mailto://jthijssen@noxlogic.nl">joshua thijssen</a>.
        
        </address>
    </div>
    <br>
</div>



                </div>
            </div>
        </div>


        <div id="footerstrip">
            <div class="container">
                <div class="span-24 last" id="footer">
                    Copyright 2012 <a href="http://www.adayinthelifeof.nl/">Joshua Thijssen</a> and others. Like to contribute? Add your recipe to our <a href="http://github.com/restcookbook/restcookbook">github repository</a>.<br>
                    Looking for Puppet recipies? Try the <a href="http://www.puppetcookbook.com">Puppet CookBook</a>.
                </div>
            </div>
        </div>

    </body>
</html>

